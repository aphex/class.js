(function(){var i=this,e=i._;!e&&"undefined"!==typeof require&&(e=require("underscore"));var m=i.Class,g;g="undefined"!==typeof exports?exports:i.Class={};g.VERSION="0.2.1-pre";g.root=i;g.noConflict=function(){i.Class=m;return this};var k=function(){};e.extend(g,{types:{String:e.isString,Number:e.isNumber,Boolean:e.isBoolean,Array:e.isArray,Function:e.isFunction,Object:e.isObject,Element:e.isElement,Regex:e.isRegExp},_extend:function(b){return g.define(this,b)},define:function(b,a){e.isFunction(b)||
(a=b,b=null);var c=a&&a.hasOwnProperty("constructor")?a.constructor:null,d=function(){if(!(this instanceof d))throw Error("Use new keyword to create a new instance or call/apply class with right scope");c?c.apply(this,arguments):b&&b.apply(this,arguments)};b&&(k.prototype=b.prototype,d.prototype=new k,d.constructor=d,d.prototype.__super__=b.prototype);d.prototype.$$error=g.error;for(var f in a)if("undefined"!==typeof this.definition[f])this.definition[f].call(this,d,a[f]);else throw Error("Unknown key in definition: "+
f+". Allowed keys are: "+e.keys(this.definition).join(", "));d.extend=this._extend;d.prototype.instanceOf=this._instanceOf;return d},error:function(b){throw b;},namespace:function(b,a){if(e.isString(b))var c=a,a=b,b=c;a=a.split(".");c=this.root;if(0<a.length){for(var d=a.pop(),f=0,g=a.length;f<g;f++)var h=a[f],c=c[h]=c[h]||{};c[d]=b}return b},singleton:function(b,a){a&&(b.$$instance=null,b.getInstance=function(){return this.$$instance||(this.$$instance=new this)})},mixins:function(b,a){this._forProto(b,
a,function(a){e.extend(b.prototype,a)})},interfaces:function(b,a){this._forProto(b,a,function(a){for(var d in a)if(!b.prototype[d])throw Error('The Class does not implement the interface member "'+d+'"');})},members:function(b,a){e.extend(b.prototype,a)},statics:function(b,a){e.extend(b,a)},properties:function(b,a){for(var c in a)this._createProperty(b,c,a[c]);b.prototype.set=this._createGenericSetter("set");b.prototype._set=this._createGenericSetter("_set")},_createGenericSetter:function(b){return function(a,
c,d){if(e.isString(a)){var f=a,a={};a[f]=c}else d=d||c;for(f in a)if(c=f.charAt(0).toUpperCase()+f.substring(1),c=b+c,this[c])this[c](a[f],d);else throw Error('No public set method for property "'+f+'" found.');return this}},_createProperty:function(b,a,c){e.isObject(c)||(c={type:c});var d=this._getPropertyMethodName(a,c,"set"),f=this._getPropertyMethodName(a,c,"get");b.prototype[d]=this._createSetter(a,c,f,d);b.prototype[f]=this._createGetter(a,c,f,d);if("Boolean"===c.type){var g=this._getPropertyMethodName(a,
c,"is");b.prototype[g]=this._createIs(a,c,f,d)}},_getPropertyMethodName:function(b,a,c){b=b.charAt(0).toUpperCase()+b.substring(1);name=c+b;if(!1===a["is"===c?"get":c])name="_"+name;return name},_createGetter:function(b,a,c,d){return function(){this.$$properties=this.$$properties||{};if("undefined"!==typeof a.init){var c=a.init;delete a.init;this[d](c)}return this.$$properties[b]}},_createSetter:function(b,a,c){return function(d,f){var f=!1===f?!1:!0,i=this[c]();if(a.format){var h=e.isString(a.format)?
this[a.format]:a.format;if(h)d=h.call(this,d,i,b);else throw Error('Format method "'+a.format+'" for property "'+b+'" not available.');}h=a.type;if(!(e.isNull(d)&&!0===a.nullable)&&h){var j=e.isFunction(h)?this.instanceOf:g.types[h];if(j){if(!j.call(this,d)){j='Wrong type for property "'+b+'". Expected value "'+d+'" to be of type "'+h+'" but found: '+typeof d;j+=". Allowed keys are: "+e.keys(g.types).join(", ");h=new g.TypeError(j,b,d,h);this.$$error.call(this,h);return}}else throw Error('Unknown type "'+
h+'" for property "'+b+'".');}if(h=a.validate)e.isArray(h)||(h=[h]),e.each(h,function(c){if(c=e.isString(c)?this[c]:c){var c=c.call(this,d,i,b),f=e.isString(c);if(!c||f)this.$$error.call(this,new g.ValidationError(f?c:'Validation for property "'+b+'" with value "'+d+'" failed',b,d))}else throw Error('Validation method "'+a.validate+'" for property "'+b+'" not available.');},this);this.$$properties[b]=d;if(a.hasOwnProperty("apply"))if(h=e.isString(a.apply)?this[a.apply]:a.apply)h.call(this,d,i,b);
else throw Error('Apply method "'+a.apply+'" for property "'+b+'" not available.');if(a.event&&f)if(h=this.trigger||this.emit)h.call(this,a.event,{target:this,value:d,old:i,property:b});else throw Error("Object does not support events");return d}},_forProto:function(b,a,c,d){e.each(a,function(a){a=e.isFunction(a)?a.prototype:a;c.call(d,a)})},_createIs:function(b,a,c){return function(){return this[c]()}},_instanceOf:function(b){return this instanceof b}});g.definition={namespace:g.namespace,singleton:g.singleton,
mixins:g.mixins,interfaces:g.interfaces,statics:g.statics,properties:g.properties,members:g.members};var l=g.ValidationError=g.define(Error,{constructor:function(b,a,c){this.name="ValidationError";this.message=b||"Validation Error";this.property=a;this.value=c}});g.TypeError=l.extend({constructor:function(b,a,c,d){l.apply(this,arguments);this.name="TypeError";this.message=b||"Type Error";this.type=d}})}).call(this);