(function(){var i=this,e=i._;!e&&"undefined"!==typeof require&&(e=require("underscore"));var m=i.Class,g;g="undefined"!==typeof exports?exports:i.Class={};g.VERSION="0.2.1-pre";g.noConflict=function(){i.Class=m;return this};var k=function(){};e.extend(g,{types:{String:e.isString,Number:e.isNumber,Boolean:e.isBoolean,Array:e.isArray,Function:e.isFunction,Object:e.isObject,Element:e.isElement,Regex:e.isRegExp},_extend:function(a){return g.define(this,a)},define:function(a,b){e.isFunction(a)||(b=a,a=
null);var c=b&&b.hasOwnProperty("constructor")?b.constructor:null,d=function(){if(!(this instanceof d))throw Error("Use new keyword to create a new instance or call/apply class with right scope");c?c.apply(this,arguments):a&&a.apply(this,arguments)};a&&(k.prototype=a.prototype,d.prototype=new k,d.constructor=d,d.prototype.__super__=a.prototype);d.prototype.$$error=g.error;for(var h in b)if("undefined"!==typeof this.definition[h])this.definition[h].call(this,d,b[h]);else throw Error("Unknown key in definition: "+
h+". Allowed keys are: "+e.keys(this.definition).join(", "));d.extend=this._extend;d.prototype.instanceOf=this._instanceOf;return d},error:function(a){throw a;},singleton:function(a,b){b&&(a.$$instance=null,a.getInstance=function(){return this.$$instance||(this.$$instance=new this)})},mixins:function(a,b){this._forProto(a,b,function(b){e.extend(a.prototype,b)})},interfaces:function(a,b){this._forProto(a,b,function(b){for(var d in b)if(!a.prototype[d])throw Error('The Class does not implement the interface member "'+
d+'"');})},members:function(a,b){e.extend(a.prototype,b)},statics:function(a,b){e.extend(a,b)},properties:function(a,b){for(var c in b)this._createProperty(a,c,b[c]);a.prototype.set=function(a){for(var b in a){var c="set"+(b.charAt(0).toUpperCase()+b.substring(1));if(this[c])this[c](a[b]);else throw Error('No public set method for property "'+b+'" found.');}return this}},_createProperty:function(a,b,c){e.isObject(c)||(c={type:c});var d=this._getPropertyMethodName(b,c,"set"),h=this._getPropertyMethodName(b,
c,"get");a.prototype[d]=this._createSetter(b,c,h,d);a.prototype[h]=this._createGetter(b,c,h,d);if("Boolean"===c.type){var g=this._getPropertyMethodName(b,c,"is");a.prototype[g]=this._createIs(b,c,h,d)}},_getPropertyMethodName:function(a,b,c){a=a.charAt(0).toUpperCase()+a.substring(1);name=c+a;if(!1===b["is"===c?"get":c])name="_"+name;return name},_createGetter:function(a,b,c,d){return function(){this.$$properties=this.$$properties||{};if("undefined"!==typeof b.init){var c=b.init;delete b.init;this[d](c)}return this.$$properties[a]}},
_createSetter:function(a,b,c){return function(d,h){var h=!1===h?!1:!0,i=this[c]();if(b.format){var f=e.isString(b.format)?this[b.format]:b.format;if(f)d=f.call(this,d,i,a);else throw Error('Format method "'+b.format+'" for property "'+a+'" not available.');}f=b.type;if(!(e.isNull(d)&&!0===b.nullable)&&f){var j=e.isFunction(f)?this.instanceOf:g.types[f];if(j){if(!j.call(this,d)){j='Wrong type for property "'+a+'". Expected value "'+d+'" to be of type "'+f+'" but found: '+typeof d;j+=". Allowed keys are: "+
e.keys(g.types).join(", ");f=new g.TypeError(j,a,d,f);this.$$error.call(this,f);return}}else throw Error('Unknown type "'+f+'" for property "'+a+'".');}if(f=b.validate)e.isArray(f)||(f=[f]),e.each(f,function(c){if(c=e.isString(c)?this[c]:c){var c=c.call(this,d,i,a),f=e.isString(c);if(!c||f)this.$$error.call(this,new g.ValidationError(f?c:'Validation for property "'+a+'" with value "'+d+'" failed',a,d))}else throw Error('Validation method "'+b.validate+'" for property "'+a+'" not available.');},this);
this.$$properties[a]=d;if(b.hasOwnProperty("apply"))if(f=e.isString(b.apply)?this[b.apply]:b.apply)f.call(this,d,i,a);else throw Error('Apply method "'+b.apply+'" for property "'+a+'" not available.');if(b.event&&h)if(f=this.trigger||this.emit)f.call(this,b.event,{target:this,value:d,old:i,property:a});else throw Error("Object does not support events");return d}},_forProto:function(a,b,c,d){e.each(b,function(a){a=e.isFunction(a)?a.prototype:a;c.call(d,a)})},_createIs:function(a,b,c){return function(){return this[c]()}},
_instanceOf:function(a){return this instanceof a}});g.definition={singleton:g.singleton,mixins:g.mixins,interfaces:g.interfaces,statics:g.statics,properties:g.properties,members:g.members};var l=g.ValidationError=g.define(Error,{constructor:function(a,b,c){this.name="ValidationError";this.message=a||"Validation Error";this.property=b;this.value=c}});g.TypeError=l.extend({constructor:function(a,b,c,d){l.apply(this,arguments);this.name="TypeError";this.message=a||"Type Error";this.type=d}})}).call(this);